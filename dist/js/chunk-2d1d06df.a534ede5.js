(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d1d06df"],{"14e9":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"detail-container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showMaterialEditor,expression:"!showMaterialEditor"}],staticClass:"detail-data-box"},[e("header",{staticClass:"search-header"},[e("div",{staticClass:"search-group"},[e("label",[t._v("ID:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.material_id,expression:"material_id"}],attrs:{type:"text",placeholder:"请输入"},domProps:{value:t.material_id},on:{input:function(a){a.target.composing||(t.material_id=a.target.value)}}})]),e("selector",{staticClass:"search-group",attrs:{value:t.status,selectParams:t.selectParams},on:{selectOptsClicked:t.selectOptsClicked}}),e("selector",{staticClass:"search-group",attrs:{value:t.dic_id,selectParams:t.labelSelectParams},on:{selectOptsClicked:t.labelSelectOptsClicked}}),e("button",{staticClass:"action-btn",on:{click:function(a){return t.loadMaterial(1)}}},[t._v("搜索")]),e("button",{directives:[{name:"show",rawName:"v-show",value:t.showAddBtn,expression:"showAddBtn"}],staticClass:"action-btn",on:{click:t.addMaterial}},[t._v("新增")])],1),e("div",{staticClass:"table-container hideScrollBar"},[e("detail-table",{attrs:{tbType:t.tbType,tbData:t.tbData,tableHeader:t.tableHeader},on:{delMaterialClicked:t.delMaterial,editMaterialClicked:t.modifyMaterial,previewBtnClicked:t.previewMaterial,pubMaterialClicked:t.changeMaterialStatus}})],1),e("page",{attrs:{pageData:t.pageData},on:{loadList:t.loadMaterial}})],1),t.showMaterialEditor?e("material-editor",{attrs:{editable:t.editable,ewmEditable:!0,materialLabelList:t.materialLabelList,material:t.material},on:{saveMaterial:t.saveMaterial,cancelEditMaterial:t.cancelEditMaterial}}):t._e()],1)},l=[],r=(e("c975"),e("a434"),e("d3b7"),e("ac1f"),e("8a79"),e("3ca3"),e("5319"),e("2ca0"),e("ddb0"),e("707d")),s=e("2c17"),d=e("4328"),n=e.n(d),o=e("bcc8"),c=e("bff1"),m=e("ef59"),h=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"detail-data-box material-editor"},[e("div",{staticClass:"editor-header"},[t._v("新增/修改素材")]),e("div",{staticClass:"editor-body hideScrollBar"},[e("div",{staticClass:"editor-groups"},[e("label",[t._v("所属标签")]),e("div",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.material.material_type,expression:"material.material_type"}],attrs:{disabled:!t.editable},on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.material,"material_type",a.target.multiple?e:e[0])}}},t._l(t.materialLabelList,(function(a,i){return e("option",{key:i,domProps:{value:a.value}},[t._v(t._s(a.text))])})),0)])]),e("div",{staticClass:"editor-groups",staticStyle:{flex:"1",height:"0"}},[e("label",[t._v("素材详情")]),e("div",[e("html-editor",{attrs:{htmlText:t.material.material_detail,config:t.htmlEditorConfig,editable:t.editable}})],1)]),e("div",{staticClass:"editor-groups"},[e("label",[t._v("生效时间")]),e("div",[e("flat-picker",{staticClass:"search-time-picker",attrs:{config:t.dateConfig,disabled:!t.editable},model:{value:t.material.start_time,callback:function(a){t.$set(t.material,"start_time",a)},expression:"material.start_time"}}),t._v(" 到 "),e("flat-picker",{staticClass:"search-time-picker",attrs:{config:t.dateConfig,disabled:!t.editable},model:{value:t.material.end_time,callback:function(a){t.$set(t.material,"end_time",a)},expression:"material.end_time"}})],1)]),e("div",{staticClass:"editor-groups",staticStyle:{height:"5.94375rem"}},[e("label",[t._v("图片上传")]),e("div",[e("span",[t._v("(最多上传9张,点击相应位置上传图片)")]),e("image-editor",{attrs:{ewmEditable:t.ewmEditable,ewm_img_index:t.material.ewm_img_index,config:t.imageConfig,images:t.material.image_list,editable:t.editable}})],1)]),e("div",{staticClass:"editor-groups"},[e("label"),e("div",[t.editable?e("button",{staticClass:"action-btn",on:{click:t.saveMaterial}},[t._v("确认")]):t._e(),e("button",{staticClass:"action-btn",on:{click:t.cancelEdit}},[t._v("取消")])])])])])},u=[],f=e("a0f6"),g=e("a8bc"),p=e("c38f"),b=e.n(p),v=(e("0952"),e("dc1c")),_={props:["material","editable","materialLabelList","ewmEditable"],components:{"html-editor":f["a"],"image-editor":g["a"],"flat-picker":b.a},data:function(){return{dateConfig:{locale:v["Mandarin"],dateFormat:"Y-m-d H:i:S",enableTime:!0,time_24hr:!0},htmlEditorConfig:{actions:{bold:!1,italic:!1,alignLeft:!1,alignCenter:!1,alignRight:!1,strikethrough:!1,underline:!1,emoji:!0,image:!1,link:!1,video:!1,fontSize:!1}},imageConfig:{maxImageNum:9}}},methods:{saveMaterial:function(){this.$parent.material["material_detail"]=this.$children[0].getContent(),this.$emit("saveMaterial")},cancelEdit:function(){this.$emit("cancelEditMaterial")}}},w=_,x=(e("e282"),e("2877")),M=Object(x["a"])(w,h,u,!1,null,"fbdedb92",null),C=M.exports,y={inject:["reload","alert","showLoading","hideLoading","loadFields","loadTBData"],components:{selector:r["a"],"detail-table":o["a"],page:m["a"],"material-editor":C},data:function(){return{showAddBtn:!1,showMaterialEditor:!1,material:{},materials:[],material_id:"",status:"",dic_id:"",tbType:"materialList",tbData:[],labelSelectParams:{label:"标签",options:[{value:"",text:"请选择"}]},selectParams:{label:"发布状态",options:[{value:"",text:"请选择"},{value:1,text:"可用"},{value:2,text:"停用"}]},pageData:{total:0,page:1,total_page:0},tableHeader:c["default"].tableHeader.materialList,fields:[],editable:!1,materialLabelList:[]}},created:function(){var t=this;return this.showLoading(),Promise.all([this.loadFields(c["default"].urls.appFields,{field_type:"materialList"},"get"),this.loadTBData(c["default"].urls.materialList,{page:1},"get"),this.loadTBData(c["default"].urls.materialLabelList,{},"get")]).then((function(a){t.fields=a[0].fields;var e=a[0].tableHeader;e[0].push({name:"操作"}),t.tableHeader=e,t.tbData=t.createTBData(a[1]),t.showAddBtn="T"==a[2]["actions"]["material_label_add"];for(var i=a[2].data||[],l=0;l<i.length;l++){var r=i[l];t.labelSelectParams.options.push({value:r["enum_item_value"],text:r["enum_item_name"]}),t.materialLabelList.push({value:r["enum_item_value"],text:r["enum_item_name"]})}})).catch((function(t){})).then((function(){t.hideLoading()}))},provide:function(){return{removeCurrImage:this.removeImage,setImage:this.setImage}},methods:{loadMaterial:function(t){var a=this;this.showLoading(),this.loadTBData(c["default"].urls.materialList,{page:t||1,material_id:this.$data["material_id"],item_value:this.$data["dic_id"],material_status:this.status}).then((function(t){a.tbData=a.createTBData(t)})).catch((function(t){})).then((function(){a.hideLoading()}))},saveMaterial:function(){var t=this;this.material["image_list"]=this.material["image_list"]||[];for(var a=this.material["image_list"].length-1;a>=0;a--)this.material["image_list"][a]||(this.material["image_list"].splice(a,1),this.material["ewm_img_index"]>a&&(this.material["ewm_img_index"]=this.material["ewm_img_index"]-1));this.showLoading();var e=this.material["material_detail"];e=e.replace(/<\/?(div|br).*?>/g,"&lt;br&gt;"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/&lt;/gi,"<"),e=e.replace(/&gt;/gi,">"),e=e.replace(/<\/?(br|div|p)(.*?)>/gi,"\n"),e=e.replace(/\n+/gi,"\n"),e.startsWith("\n")&&(e=e.replace("\n","")),e.endsWith("\n")&&(e=e.substring(0,e.length-1)),e=e.replace(/<\/?span(.*?)>/gi,""),e=e.replace(/<\/?pre(.*?)>/gi,"");var i={material_type:this.material["material_type"],material_detail:e,start_time:this.material["start_time"],end_time:this.material["end_time"],ewm_img_index:this.material["ewm_img_index"]};if(this.material["id"]&&(i["material_id"]=this.material["id"]),this.material["image_list"])for(var l=0;l<this.material["image_list"].length;l++)i["pic_"+(l+1)]=this.material["image_list"][l];Object(s["a"])({url:c["default"].urls.editMaterial,method:"post",data:n.a.stringify(i)}).then((function(a){if(200==a.status){if(200==a.data.code)return t.loadTBData(c["default"].urls.materialList,{material_id:t.$data["material_id"],page:t.pageData.page||1,item_value:t.$data["dic_id"],material_status:t.status}).then((function(a){t.tbData=t.createTBData(a)}));t.alert(a.data.message||"保存素材失败")}else t.alert("保存素材失败")})).catch((function(a){t.alert("保存素材失败")})).then((function(){t.hideLoading(),t.showMaterialEditor=!1}))},changeMaterialStatus:function(t){var a=this;this.showLoading(),Object(s["a"])({url:c["default"].urls.changeMaterialStatu,params:{material_id:this.materials[t].id,material_status:0==this.materials[t]["material_status"]?1:2},method:"get"}).then((function(e){200==e.status?200==e.data.code?(a.materials[t]["material_status"]=0==a.materials[t]["material_status"]?1:0,a.tbData[t][4]=0==a.materials[t]["material_status"]?"隐藏":"显示",a.tbData[t][10]["material_close"]=0==a.materials[t]["material_status"]?"F":"T",a.tbData[t][10]["material_open"]=0==a.materials[t]["material_status"]?"T":"F",a.tbData[t][10]["material_status"]=a.materials[t]["material_status"],a.tbData[t][10]["material_edit"]=0==a.materials[t]["material_status"]?"T":"F"):a.alert(e.data.message||"修改素材发布状态失败"):a.alert("修改素材发布状态失败")})).catch((function(t){a.alert("修改素材发布状态失败")})).then((function(){a.hideLoading()}))},createTBData:function(t){this.pageData.total=t.total,this.pageData.page=t.page,this.pageData["total_page"]=t.total_page||t.pageCount||0,this.materials=t.data||[];for(var a=[],e=0;e<this.materials.length;e++){var i=this.materials[e];a.push([]);for(var l=0;l<this.fields.length;l++)if("material_detail"==this.fields[l]){var r=i[this.fields[l]]||"--";while(r.indexOf("&lt;")>=0)r=r.replace("&lt;","<");while(r.indexOf("&gt;")>=0)r=r.replace("&gt;",">");i[this.fields[l]]=r,a[e].push(r)}else a[e].push(i[this.fields[l]]||"--");a[e].push({material_edit:i["material_edit"],material_open:i["material_open"],material_close:i["material_close"],material_status:i["material_status"]})}return a},selectOptsClicked:function(t){this.status=t},labelSelectOptsClicked:function(t){this.$data["dic_id"]=t},modifyMaterial:function(t){var a=JSON.parse(JSON.stringify(this.materials[t]));this.material=Object.assign({},a);while(this.material&&this.material.detail&&this.material.detail.indexOf("&lt;")>=0)this.material.detail=this.material.detail.replace("&lt;","<");while(this.material&&this.material.detail&&this.material.detail.indexOf("&gt;")>=0)this.material.detail=this.material.detail.replace("&gt;",">");this.showMaterialEditor=!0,this.$parent.subTitle2="编辑素材",this.editable=!0},previewMaterial:function(t){this.modifyMaterial(t),this.editable=!1},delMaterial:function(t){},addMaterial:function(){this.material={material_type:null,material_detail:"",image_list:[],ewm_img_index:-1},this.showMaterialEditor=!0,this.$parent.subTitle2="新增素材",this.editable=!0},cancelEditMaterial:function(){this.showMaterialEditor=!1},removeImage:function(t){this.material["image_list"].splice(t,1,"")},setImage:function(t){var a=this.material["image_list"]||[];a[t.idx]=t.imgUrl,this.material["image_list"]=Object.assign([],a)}}},k=y,L=(e("7066"),Object(x["a"])(k,i,l,!1,null,"241bcc9e",null));a["default"]=L.exports},"1dde":function(t,a,e){var i=e("d039"),l=e("b622"),r=e("2d00"),s=l("species");t.exports=function(t){return r>=51||!i((function(){var a=[],e=a.constructor={};return e[s]=function(){return{foo:1}},1!==a[t](Boolean).foo}))}},"263d":function(t,a,e){var i=e("24fb");a=i(!1),a.push([t.i,".material-editor[data-v-fbdedb92]{padding:0;color:#333}.editor-header[data-v-fbdedb92]{font-weight:700;height:2.34375rem;line-height:2.34375rem;border-bottom:1px solid #e6e6e6;font-size:.5625rem;padding-left:1.125rem}.editor-body[data-v-fbdedb92]{height:0;-webkit-box-flex:1;-ms-flex:1;flex:1;padding:.75rem 1.125rem;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;overflow:hidden;overflow-y:scroll}.editor-body[data-v-fbdedb92],.editor-groups[data-v-fbdedb92]{display:-webkit-box;display:-ms-flexbox;display:flex}.editor-groups[data-v-fbdedb92]{width:100%;height:1.25rem;line-height:1.25rem;margin-top:.625rem;font-size:.4375rem}.editor-groups[data-v-fbdedb92]:first-child{margin-top:0}.editor-groups label[data-v-fbdedb92]{width:3.0625rem;height:100%;line-height:1.25rem}.editor-groups>div[data-v-fbdedb92]{-webkit-box-flex:1;-ms-flex:1;flex:1;height:100%;width:0}.editor-groups input[data-v-fbdedb92],.editor-groups select[data-v-fbdedb92]{font-size:.4375rem;width:15.9375rem;height:100%;line-height:1.25rem;border:1px solid #d9d9d9;border-radius:.125rem;padding:.3125rem;-webkit-box-sizing:border-box;box-sizing:border-box}.editor-groups select[data-v-fbdedb92]{-webkit-appearance:menulist}.editor-groups input.search-time-picker[data-v-fbdedb92]{width:7.5rem}",""]),t.exports=a},4818:function(t,a,e){var i=e("263d");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var l=e("499e").default;l("6afd08b7",i,!0,{sourceMap:!1,shadowMode:!1})},"65f0":function(t,a,e){var i=e("861d"),l=e("e8b5"),r=e("b622"),s=r("species");t.exports=function(t,a){var e;return l(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!l(e.prototype)?i(e)&&(e=e[s],null===e&&(e=void 0)):e=void 0),new(void 0===e?Array:e)(0===a?0:a)}},7066:function(t,a,e){"use strict";var i=e("ff7e"),l=e.n(i);l.a},8418:function(t,a,e){"use strict";var i=e("c04e"),l=e("9bf2"),r=e("5c6c");t.exports=function(t,a,e){var s=i(a);s in t?l.f(t,s,r(0,e)):t[s]=e}},"8a79":function(t,a,e){"use strict";var i=e("23e7"),l=e("06cf").f,r=e("50c4"),s=e("5a34"),d=e("1d80"),n=e("ab13"),o=e("c430"),c="".endsWith,m=Math.min,h=n("endsWith"),u=!o&&!h&&!!function(){var t=l(String.prototype,"endsWith");return t&&!t.writable}();i({target:"String",proto:!0,forced:!u&&!h},{endsWith:function(t){var a=String(d(this));s(t);var e=arguments.length>1?arguments[1]:void 0,i=r(a.length),l=void 0===e?i:m(r(e),i),n=String(t);return c?c.call(a,n,l):a.slice(l-n.length,l)===n}})},a434:function(t,a,e){"use strict";var i=e("23e7"),l=e("23cb"),r=e("a691"),s=e("50c4"),d=e("7b0b"),n=e("65f0"),o=e("8418"),c=e("1dde"),m=e("ae40"),h=c("splice"),u=m("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,g=Math.min,p=9007199254740991,b="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!h||!u},{splice:function(t,a){var e,i,c,m,h,u,v=d(this),_=s(v.length),w=l(t,_),x=arguments.length;if(0===x?e=i=0:1===x?(e=0,i=_-w):(e=x-2,i=g(f(r(a),0),_-w)),_+e-i>p)throw TypeError(b);for(c=n(v,i),m=0;m<i;m++)h=w+m,h in v&&o(c,m,v[h]);if(c.length=i,e<i){for(m=w;m<_-i;m++)h=m+i,u=m+e,h in v?v[u]=v[h]:delete v[u];for(m=_;m>_-i+e;m--)delete v[m-1]}else if(e>i)for(m=_-i;m>w;m--)h=m+i-1,u=m+e-1,h in v?v[u]=v[h]:delete v[u];for(m=0;m<e;m++)v[m+w]=arguments[m+2];return v.length=_-i+e,c}})},c2d8:function(t,a,e){var i=e("24fb");a=i(!1),a.push([t.i,".detail-container[data-v-241bcc9e]{background-color:#f2f2f2;padding:0;margin:0;overflow-y:scroll}.detail-data-box[data-v-241bcc9e]{margin-top:0}",""]),t.exports=a},e282:function(t,a,e){"use strict";var i=e("4818"),l=e.n(i);l.a},e8b5:function(t,a,e){var i=e("c6b6");t.exports=Array.isArray||function(t){return"Array"==i(t)}},ff7e:function(t,a,e){var i=e("c2d8");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var l=e("499e").default;l("443a6cb4",i,!0,{sourceMap:!1,shadowMode:!1})}}]);